<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Insert title here</title>
<script src="https://code.jquery.com/jquery-3.6.3.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Gamja+Flower&family=Jua&family=Lobster&family=Nanum+Pen+Script&family=Single+Day&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
<style>
	.mycaricon {
		margin: 30px 30px;
		font-size: 30px; 
	}
	#list1, #list2 {
		cursor: pointer;
	}
	.list {
		margin-left: 30px;
		margin-top: 20px;
		font-size: 15px;
	}
	.cardel {
		cursor: pointer;
	}
</style>
<script type = "text/javascript">
	$(function() {
		// 처음 로딩시 사진위주로 나오게한다
		
		//list2();
		
		// 마지막 선택한 메뉴가 새로고침을 해도 그대로이게 하기
		let select = localStorage.getItem("list_type");
		if(select == null || select == '2') {
			$("#list1").css("color", "black");
			$("#list2").css("color", "red");
			list2();
		}
		else {
			$("#list2").css("color", "black");
			$("#list1").css("color", "red");
			list1();
		}
		
		
		// 두번째 아이콘의 색을 빨강색으로 변경
		// $("#list2").css("color", "red");
		
		$("#list1").click(function() {
			$(this).css("color", "red");
			$("#list2").css("color", "black");
			
			// localStorage.select = 1;
			localStorage.setItem("list_type", '1')
			
			list1();
		})
		$("#list2").click(function() {
			$(this).css("color", "red");
			$("#list1").css("color", "black");
			
			// localStorage.select = 2;
			localStorage.setItem("list_type", '2')
			
			list2();
		})
		
		$(document).on("click", ".cardel", function() {
			// num 읽기
			let num = $(this).attr("num");
			
			let b = confirm("삭제하려면 확인 버튼을 눌러주세요")
			if(b) {
				$.ajax({
					type: "get",
					url: "deleteCar.jsp",
					data: "num=" + num,
					dataType: "html",
					success: function(res) {
						// 삭제 성공후 화면 새로고침
						location.reload();
					},
					statusCode: {
						404: function() {
							alert("파일이 없어요")
						},
						500: function() {
							alert("서버 오류.. 다시한번 코드를 확인하세요")
						}
					}
				})
			}
		})

	})
	
	function list1() {
		$.ajax({
			type: "get",
			url: "../data/jsoncardata.jsp",
			dataType: "json",
			success: function(res) {
				let s = "";
				s += '<div class = container style = "border: 1px solid black">';
				$.each(res, function(idx, element) {
					s += `<div class = 'row'>`;
					s += `<div class = 'col' style = "width: 50px;">${element.num}</div>`;
					s += `<div class = 'col' style = "width: 200px;">
							<img src="../image/${element.carphoto}" border = "1" style = "width: 50px;">
							${element.carname}
						</div>`;
					s += `<div class = 'col' style = "width: 100px;">${element.carprice}</div>`;
					s += `<div class = 'col' style = "width: 150px;">${element.guipday}</div>`;
					s += `</div>`;
				});
				
				
				s += '</div>';
				$("div.list").html(s);
			},
			statusCode: {
				404: function() {
					alert("파일이 없어요")
				},
				500: function() {
					alert("서버 오류.. 다시한번 코드를 확인하세요")
				}
			}
		});
	}
	
	function list2() {
		$.ajax({
			type: "get",
			url: "../data/jsoncardata.jsp",
			dataType: "json",
			success: function(res) {
				let s = "";
				s += "<table class='table table-bordered'>";
				s += "<tr>";
				$.each(res, function(idx, element) {
					s += "<td align='center'>"
					// 사진넣기
					s += `<img src="../image/${element.carphoto}" border = "1" style = "width: 100px; height: 80px;">`
					s += `<br>${element.carname}<i class="bi bi-trash cardel" num = ${element.num}></i>`
					s += `<br>${element.carprice}<br>`
					s += "</td>"
					
					// 한줄에 사진 3개씩만 출력
					if((idx + 1) % 3 == 0) {
						s += "</tr><tr>"
					}
				})
				s += "</tr>"
				s += "</table>"
				$("div.list").html(s);
			},
			statusCode: {
				404: function() {
					alert("파일이 없어요")
				},
				500: function() {
					alert("서버 오류.. 다시한번 코드를 확인하세요")
				}
			}
		})
	}
</script>
</head>
<body>
<div class="mycar">
	<i class = "bi bi-card-list" id = "list1"></i>
	<i class = "bi bi-image" id = "list2"></i>
</div>
<div class = "list"></div>
</body>
</html>